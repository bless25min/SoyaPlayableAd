<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<title>äº¤æ˜“ç²åˆ©æŒ‘æˆ°è³½</title>
<style>
:root {
  --bg: #f4f7fc;
  --panel: #ffffff;
  --panel-soft: #f9fafc;
  --text: #1a1e2b;
  --muted: #6b7280;
  --border-color: #e5e7eb;
  --accent: #4a72ff;
  --good: #10b981; /* Green for profit */
  --danger: #ef4444; /* Red for loss */
  --grid: rgba(0, 0, 0, 0.05);
  /* Chart Colors: Green for Up, Red for Down */
  --chart-bg: #ffffff;
  --chart-text: #6b7280;
  --chart-up: #10b981;   /* é™½æ£’é¡è‰² */
  --chart-down: #ef4444; /* é™°æ£’é¡è‰² */
}

* { box-sizing: border-box; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; -webkit-tap-highlight-color: transparent; }

html, body {
  margin: 0; padding: 0; height: 100%; width: 100%;
  overflow: hidden; background-color: var(--bg); color: var(--text);
  font-size: 14px;
}

.app-container {
  display: flex; flex-direction: column; height: 100%; width: 100%;
  max-width: 420px; margin: 0 auto; background-color: var(--panel);
  box-shadow: 0 0 20px rgba(0,0,0,0.05);
}

/* --- é ‚éƒ¨è³‡è¨Š --- */
.header {
  padding: 8px 16px; border-bottom: 1px solid var(--border-color);
  flex-shrink: 0; text-align: center;
}
.header .stats { display: flex; justify-content: space-around; font-size: 14px; }
.header .stats div { display: flex; flex-direction: column; }
.header .stats .label { font-size: 12px; color: var(--muted); }
.header .stats .value { font-weight: bold; }
.header .pnl-up { color: var(--good); }
.header .pnl-down { color: var(--danger); }
.progress-bar { width: 100%; height: 4px; background: var(--border-color); border-radius: 2px; margin-top: 8px; overflow: hidden; }
.progress-bar-inner { width: 0%; height: 100%; background: var(--accent); transition: width 0.2s linear; }

/* --- åœ–è¡¨å€ --- */
#chartWrap {
  flex-grow: 1; position: relative; background: var(--chart-bg);
  min-height: 0; cursor: grab;
}
#chartWrap:active { cursor: grabbing; }
#chart { width: 100%; height: 100%; display: block; }

.price-axis {
    position: absolute;
    right: 0;
    top: 0;
    bottom: 0;
    width: 60px;
    pointer-events: none;
    border-left: 1px solid var(--border-color);
}
.price-axis-tick {
    position: absolute;
    width: 100%;
    padding-right: 5px;
    font-size: 12px;
    color: var(--chart-text);
    transform: translateY(-50%);
    text-align: right;
}
.price-line {
    position: absolute;
    left: 0;
    right: 60px;
    height: 1px;
    pointer-events: none;
    border-top: 1px dashed var(--muted);
}
.price-line-label {
    position: absolute;
    right: 60px;
    padding: 2px 6px;
    font-size: 12px;
    color: #ffffff;
    border-radius: 4px;
    transform: translate(100%, -50%);
}

/* --- åº•éƒ¨æ“ä½œå€ --- */
.actions-panel {
  flex-shrink: 0; background: var(--panel);
  border-top: 1px solid var(--border-color);
}
.tabs { display: flex; border-bottom: 1px solid var(--border-color); }
.tab-btn {
  flex: 1; padding: 12px; background: none; border: none;
  color: var(--muted); cursor: pointer; border-bottom: 2px solid transparent;
  font-size: 14px;
}
.tab-btn.active { color: var(--text); border-bottom-color: var(--accent); font-weight: bold; }

.tab-content { display: none; padding: 12px; }
.tab-content.active { display: block; }

#trade-panel-content {
    display: grid;
    grid-template-areas:
        "sl lots tp"
        "sell close buy";
    gap: 8px;
    align-items: center;
}
#trade-sl-group { grid-area: sl; }
#trade-lots-group { grid-area: lots; }
#trade-tp-group { grid-area: tp; }
#btnSell { grid-area: sell; }
#btnCloseAll { grid-area: close; background-color: var(--muted); color: white; }
#btnBuy { grid-area: buy; }

.btn { padding: 12px; font-size: 16px; font-weight: bold; border-radius: 8px; border: none; cursor: pointer; transition: transform 0.1s ease, filter 0.1s ease; }
.btn.buy { background: var(--chart-up); color: white; }
.btn.sell { background: var(--chart-down); color: white; }
.btn:active { 
    transform: scale(0.96); 
    filter: brightness(0.9);
}

.playback-controls {
    display: flex; justify-content: center; align-items: center;
    gap: 8px; padding: 8px 0;
}
.playback-controls .btn {
    background: var(--panel-soft); color: var(--text);
    border: 1px solid var(--border-color);
    padding: 8px 10px; font-size: 12px;
}
.playback-controls .btn.active { background: var(--accent); color: white; border-color: var(--accent); }

.input-group { display: flex; flex-direction: column; text-align: center;}
.input-group label { font-size: 12px; color: var(--muted); margin-bottom: 4px; }
.input-group input { text-align: center; width: 100%; background: var(--bg); border: 1px solid var(--border-color); border-radius: 8px; padding: 8px; color: var(--text); font-size: 14px; }

/* Input Stepper Styles */
.input-stepper {
    display: flex;
    align-items: center;
    background: var(--bg);
    border: 1px solid var(--border-color);
    border-radius: 8px;
    overflow: hidden;
}
.input-stepper input {
    border: none;
    background: transparent;
    flex-grow: 1;
    padding: 8px;
    width: 50px; /* Give it a base width */
}
.stepper-btns {
    display: flex;
    flex-direction: column;
    align-self: stretch;
}
.stepper-btn {
    background: transparent;
    border: none;
    cursor: pointer;
    padding: 0 8px;
    color: var(--muted);
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    border-left: 1px solid var(--border-color);
    transition: background-color 0.1s ease;
}
.stepper-btn:first-child {
    border-bottom: 1px solid var(--border-color);
}
.stepper-btn:active {
    background: #e0e2e7;
}


/* Hides the default arrows for number input */
input[type=number]::-webkit-inner-spin-button, 
input[type=number]::-webkit-outer-spin-button { 
  -webkit-appearance: none; 
  margin: 0; 
}
input[type=number] {
  -moz-appearance: textfield;
}


#positions-list, #journal-list { max-height: 25vh; overflow-y: auto; }
.position-item { 
    background: var(--panel-soft); 
    padding: 10px; 
    border-radius: 8px; 
    margin-bottom: 8px; 
    display: grid; 
    grid-template-columns: 1fr 1fr;
    grid-template-areas: 
        "info pnl"
        "sl tp"
        "actions actions";
    gap: 8px; 
    align-items: center;
}
.position-item-info { grid-area: info; }
.position-item-pnl { grid-area: pnl; text-align: right; font-weight: bold; }
.position-item-sl { grid-area: sl; }
.position-item-tp { grid-area: tp; }
.position-item-actions { grid-area: actions; display: flex; gap: 8px; }

.position-item .side-buy { color: var(--good); font-weight: bold; }
.position-item .side-sell { color: var(--danger); font-weight: bold; }
.position-item .pnl-up { color: var(--good); }
.position-item .pnl-down { color: var(--danger); }
.position-item .close-btn, .position-item .modify-btn { flex: 1; padding: 6px; font-size: 12px; }
.position-item .close-btn { background: var(--danger); color: white; }
.position-item .modify-btn { background: var(--accent); color: white; }
.position-item .input-group { margin-bottom: 0; }
.position-item .input-group input { padding: 6px; font-size: 12px; }

.journal-item {
    background: var(--panel-soft); 
    padding: 10px; 
    border-radius: 8px; 
    margin-bottom: 8px; 
    display: grid;
    grid-template-columns: 1fr auto;
    gap: 4px 16px;
    font-size: 12px;
}
.journal-item-info { grid-column: 1 / 2; }
.journal-item-pnl { grid-column: 2 / 3; grid-row: 1 / 3; text-align: right; font-weight: bold; font-size: 14px; align-self: center; }
.journal-item-time { grid-column: 1 / 2; color: var(--muted); }
.journal-item .pnl-up { color: var(--good); }
.journal-item .pnl-down { color: var(--danger); }


/* --- å½ˆçª— --- */
.modal-overlay {
  position: fixed; inset: 0; background: rgba(0,0,0,.5);
  backdrop-filter: blur(4px); z-index: 9997;
  display: flex; justify-content: center; align-items: center;
  opacity: 0; pointer-events: none; transition: opacity 0.3s ease;
}
.modal-overlay.visible { opacity: 1; pointer-events: auto; }
.modal-content {
  width: min(90vw, 380px); background: var(--panel);
  border: 1px solid var(--border-color); border-radius: 16px;
  padding: 24px; text-align: center;
  transform: scale(0.9); transition: transform 0.3s ease;
  box-shadow: 0 10px 30px rgba(0,0,0,0.1);
}
.modal-overlay.visible .modal-content { transform: scale(1); }
.modal-header { font-weight: bold; margin-bottom: 16px; font-size: 20px; }
.event-modal-icon { font-size: 48px; margin-bottom: 12px; }
.event-modal-desc { color: var(--muted); margin-bottom: 20px; text-align: left; line-height: 1.6; }

</style>
</head>
<body>

<div class="app-container">
  <div class="header">
    <div class="stats">
        <div><span class="label">æ¨¡æ“¬æ—¥æœŸ</span><span class="value" id="current-date">--</span></div>
        <div><span class="label">å¸³æˆ¶æ·¨å€¼</span><span class="value" id="equity">$10000.00</span></div>
        <div><span class="label">ç¸½æç›Š</span><span class="value" id="total-pnl">$0.00</span></div>
    </div>
    <div class="progress-bar"><div id="progress-bar-inner" class="progress-bar-inner"></div></div>
  </div>
  <div id="chartWrap">
    <canvas id="chart"></canvas>
    <div id="price-lines-container"></div>
    <div class="price-axis" id="price-axis"></div>
  </div>
  <div class="actions-panel">
    <div class="tabs">
        <button class="tab-btn active" data-tab="trade-panel">äº¤æ˜“</button>
        <button class="tab-btn" data-tab="positions-panel">æŒå€‰</button>
        <button class="tab-btn" data-tab="journal-panel">ç´€éŒ„</button>
    </div>
    <div id="trade-panel" class="tab-content active">
        <div id="trade-panel-content">
            <div id="trade-sl-group" class="input-group">
                <label for="trade-sl">åœæ SL</label>
                <div class="input-stepper">
                    <input id="trade-sl" type="number" placeholder="åƒ¹æ ¼" data-step="0.5">
                    <div class="stepper-btns">
                        <button class="stepper-btn" data-target="trade-sl" data-direction="up">â–²</button>
                        <button class="stepper-btn" data-target="trade-sl" data-direction="down">â–¼</button>
                    </div>
                </div>
            </div>
            <div id="trade-lots-group" class="input-group">
                <label for="trade-lots">æ‰‹æ•¸</label>
                <div class="input-stepper">
                    <input id="trade-lots" type="number" value="0.1" step="0.01" min="0.01">
                    <div class="stepper-btns">
                        <button class="stepper-btn" data-target="trade-lots" data-direction="up">â–²</button>
                        <button class="stepper-btn" data-target="trade-lots" data-direction="down">â–¼</button>
                    </div>
                </div>
            </div>
            <div id="trade-tp-group" class="input-group">
                <label for="trade-tp">åœåˆ© TP</label>
                <div class="input-stepper">
                     <input id="trade-tp" type="number" placeholder="åƒ¹æ ¼" data-step="0.5">
                     <div class="stepper-btns">
                        <button class="stepper-btn" data-target="trade-tp" data-direction="up">â–²</button>
                        <button class="stepper-btn" data-target="trade-tp" data-direction="down">â–¼</button>
                    </div>
                </div>
            </div>
            <button class="btn sell" id="btnSell">Sell</button>
            <button class="btn" id="btnCloseAll">å¹³å€‰</button>
            <button class="btn buy" id="btnBuy">Buy</button>
        </div>
    </div>
    <div id="positions-panel" class="tab-content">
        <div id="positions-list"></div>
    </div>
    <div id="journal-panel" class="tab-content">
        <div id="journal-list"></div>
    </div>
    <div class="playback-controls">
        <button class="btn" id="play-pause-btn">â–¶</button>
        <button class="btn" id="step-btn">é€K â†’</button>
        <div id="speed-controls">
            <button class="btn speed-btn active" data-speed="400">0.25x</button>
            <button class="btn speed-btn" data-speed="200">0.5x</button>
            <button class="btn speed-btn" data-speed="100">1x</button>
            <button class="btn speed-btn" data-speed="50">2x</button>
            <button class="btn speed-btn" data-speed="10">5x</button>
        </div>
        <button class="btn" id="zoom-out">-</button>
        <button class="btn" id="zoom-in">+</button>
    </div>
  </div>
</div>

<!-- äº‹ä»¶ Modal -->
<div id="eventModal" class="modal-overlay">
    <div class="modal-content event-modal-content">
      <div class="event-modal-icon">ğŸ“°</div>
      <h2 class="modal-header" id="event-title"></h2>
      <p class="event-modal-desc" id="event-desc"></p>
      <button class="btn" id="event-continue-btn">ç¹¼çºŒ</button>
    </div>
</div>

<script>
// ===== è²¡ç¶“äº‹ä»¶æ•¸æ“š (çœç•¥) =====
const EVENTS = {
  "2025-01-03": { time: "21:30", title: "ğŸ‡ºğŸ‡¸ ç¾åœ‹éè¾²å°±æ¥­æ•¸æ“š (NFP)", desc: "ä¿—ç¨±ã€Œéè¾²ã€çš„ç¾åœ‹å°±æ¥­æ•¸æ“šæ˜¯å¸‚å ´æœ€é—œæ³¨çš„æŒ‡æ¨™ä¹‹ä¸€ã€‚æ•¸æ“šå¥½å£å°‡åŠ‡çƒˆå½±éŸ¿é»ƒé‡‘åƒ¹æ ¼ï¼Œå¸‚å ´å±æ¯ä»¥å¾…ï¼" },
  "2025-01-20": { time: "12:00", title: "ğŸ‡ºğŸ‡¸ ç¾åœ‹ç¸½çµ±å°±è·å…¸ç¦®", desc: "æ–°ä»»ç¾åœ‹ç¸½çµ±å°‡æ–¼è¯ç››é “ç‰¹å€å®£èª“å°±è·ã€‚å°±è·æ¼”èªªé€šå¸¸æœƒæ¦‚è¿°æ–°æ”¿åºœçš„æ–½æ”¿è—åœ–ï¼Œå…§å®¹å¯èƒ½æ¶‰åŠåœ‹å…§å¤–æ”¿ç­–ã€ç¶“æ¿Ÿæ–¹å‘ç­‰ï¼Œé€™äº›éƒ½å¯èƒ½æˆç‚ºå¸‚å ´é—œæ³¨çš„ç„¦é»ã€‚" },
  "2025-01-30": { time: "20:45", title: "ğŸ‡ªğŸ‡º æ­æ´²å¤®è¡Œ (ECB) åˆ©ç‡æ±ºç­–æœƒè­°", desc: "æ­æ´²å¤®è¡Œç®¡ç†å§”å“¡æœƒå°‡å¬é–‹è²¨å¹£æ”¿ç­–æœƒè­°ä¸¦ç™¼å¸ƒåˆ©ç‡æ±ºç­–è²æ˜ã€‚å¸‚å ´å°‡é—œæ³¨å…¶å°æ­å…ƒåŒºç¶“æ¿Ÿå‰æ™¯å’Œé€šè†¨è·¯å¾‘çš„æœ€æ–°è©•ä¼°ã€‚" },
  "2025-02-07": { time: "21:30", title: "ï¿½ğŸ‡¸ ç¾åœ‹éè¾²å°±æ¥­æ•¸æ“š (NFP)", desc: "æœ¬æœˆéè¾²æ•¸æ“šå…¬å¸ƒï¼Œå°‡å†æ¬¡è€ƒé©—å¸‚å ´å°ç¾åœ‹ç¶“æ¿Ÿå¾©ç”¦åŠ›åº¦çš„ä¿¡å¿ƒã€‚" },
  "2025-03-05": { time: "10:00", title: "ğŸ‡¨ğŸ‡³ ä¸­åœ‹å…¨åœ‹äººæ°‘ä»£è¡¨å¤§æœƒå¹´æœƒé–‹å¹•", desc: "ä¸­åœ‹å°‡å…¬å¸ƒç•¶å¹´åº¦çš„GDPå¢é•·ç›®æ¨™ã€è²¡æ”¿é ç®—ç­‰ä¸»è¦ç¶“æ¿ŸæŒ‡æ¨™ï¼Œä¸¦é—¡è¿°ç›¸é—œæ”¿ç­–æ–¹å‘ã€‚" },
  "2025-03-07": { time: "21:30", title: "ğŸ‡ºğŸ‡¸ ç¾åœ‹éè¾²å°±æ¥­æ•¸æ“š (NFP)", desc: "é€£çºŒç¬¬ä¸‰å€‹æœˆçš„éè¾²æ•¸æ“šï¼Œå¸‚å ´å°‡å°‹æ‰¾å‹å‹•åŠ›å¸‚å ´æ˜¯å¦æŒçºŒç©©å®šçš„ç·šç´¢ã€‚" },
  "2025-03-19": { time: "03:00", title: "ğŸ‡ºğŸ‡¸ è¯æº–æœƒåˆ©ç‡æ±ºç­– (FOMC)", desc: "è¯æº–æœƒå°‡ç™¼å¸ƒåˆ©ç‡æ±ºç­–ï¼Œæœƒè­°å°‡åŒ…å«æœ€æ–°çš„ç¶“æ¿Ÿé æ¸¬æ‘˜è¦ (SEP) å’Œã€Œé»é™£åœ–ã€ï¼Œæ­ç¤ºæœªä¾†åˆ©ç‡è·¯å¾‘é æœŸã€‚" },
  "2025-04-04": { time: "21:30", title: "ğŸ‡ºğŸ‡¸ ç¾åœ‹éè¾²å°±æ¥­æ•¸æ“š (NFP)", desc: "ç¬¬äºŒå­£åº¦çš„é¦–æ¬¡éè¾²å ±å‘Šï¼Œå°‡ç‚ºå¸‚å ´å°ä¸ŠåŠå¹´çš„ç¶“æ¿Ÿé æ¸¬å®šä¸‹åŸºèª¿ã€‚" },
  "2025-04-10": { time: "20:45", title: "ğŸ‡ªğŸ‡º æ­æ´²å¤®è¡Œ (ECB) åˆ©ç‡æ±ºç­–æœƒè­°", desc: "åœ¨ç¬¬ä¸€å­£ç¶“æ¿Ÿæ•¸æ“šå…¬å¸ƒä¹‹å¾Œï¼Œå¸‚å ´å°‡é—œæ³¨æ­æ´²å¤®è¡Œæ˜¯å¦æœƒæ ¹æ“šæœ€æ–°æ•¸æ“šèª¿æ•´å…¶è²¨å¹£æ”¿ç­–ç«‹å ´ã€‚" },
  "2025-04-21": { time: "09:00", title: "IMF ã€Šä¸–ç•Œç¶“æ¿Ÿå±•æœ›ã€‹å ±å‘Š", desc: "åœ‹éš›è²¨å¹£åŸºé‡‘çµ„ç¹”å°‡æ›´æ–°å°å…¨çƒä¸»è¦ç¶“æ¿Ÿé«”çš„å¢é•·é æ¸¬ï¼Œä¸¦åˆ†æå…¨çƒé¢è‡¨çš„æ½›åœ¨é¢¨éšªã€‚" },
  "2025-05-02": { time: "21:30", title: "ğŸ‡ºğŸ‡¸ ç¾åœ‹éè¾²å°±æ¥­æ•¸æ“š (NFP)", desc: "æ˜¥å­£çš„å°±æ¥­å¸‚å ´è¡¨ç¾å¦‚ä½•ï¼Ÿæœ¬æ¬¡éè¾²æ•¸æ“šå°‡æä¾›é—œéµç­”æ¡ˆã€‚" },
  "2025-05-09": { time: "15:00", title: "ğŸ‡·ğŸ‡º ä¿„ç¾…æ–¯å‹åˆ©æ—¥é–±å…µ", desc: "ä¿„ç¾…æ–¯ç¸½çµ±é€šå¸¸æœƒç™¼è¡¨æ¼”èªªï¼Œå¸‚å ´æœƒé—œæ³¨å…¶ç™¼è¨€æ˜¯å¦åŒ…å«ä»»ä½•æ–°çš„åœ°ç·£æ”¿æ²»ä¿¡è™Ÿã€‚" },
  "2025-06-06": { time: "21:30", title: "ğŸ‡ºğŸ‡¸ ç¾åœ‹éè¾²å°±æ¥­æ•¸æ“š (NFP)", desc: "å¤å­£å‰çš„æœ€å¾Œä¸€æ¬¡é‡è¦å°±æ¥­å ±å‘Šï¼Œå¯èƒ½å½±éŸ¿è¯æº–æœƒä¸‹åŠå¹´çš„æ”¿ç­–é æœŸã€‚" },
  "2025-06-13": { time: "14:00", title: "G7 é ˜è¢–å³°æœƒé–‹å¹•", desc: "ä¸ƒåœ‹é›†åœ˜å³°æœƒåœ¨åŠ æ‹¿å¤§èˆ‰è¡Œï¼Œæœƒè­°è­°ç¨‹æ¶µè“‹å…¨çƒç¶“æ¿Ÿã€æ°£å€™è®Šé·ã€åœ°ç·£æ”¿æ²»ç­‰å¤šé …è­°é¡Œã€‚" },
  "2025-07-01": { time: "10:00", title: "ğŸ‡¨ğŸ‡³ ä¸­åœ‹å…±ç”¢é»¨æˆç«‹é€±å¹´ç´€å¿µæ—¥", desc: "ç›¸é—œæ´»å‹•å’Œè²æ˜å¯èƒ½æœƒå‚³é”é—œæ–¼ä¸­åœ‹æœªä¾†ç™¼å±•æ–¹å‘çš„ä¿¡è™Ÿã€‚" },
  "2025-07-03": { time: "21:30", title: "ğŸ‡ºğŸ‡¸ ç¾åœ‹éè¾²å°±æ¥­æ•¸æ“š (NFP)", desc: "å› 7æœˆ4æ—¥ç‚ºç¾åœ‹ç¨ç«‹æ—¥å‡æœŸï¼Œæœ¬æœˆéè¾²æ•¸æ“šæå‰è‡³é€±å››å…¬å¸ƒã€‚" },
  "2025-07-30": { time: "21:30", title: "ğŸ‡ºğŸ‡¸ ç¾åœ‹ç¬¬äºŒå­£GDPåˆå€¼", desc: "è©²æ•¸æ“šæ˜¯è¡¡é‡ç¾åœ‹ç¶“æ¿Ÿå¥åº·ç‹€æ³çš„é‡è¦æŒ‡æ¨™ï¼Œå°‡æä¾›å°ç¬¬äºŒå­£åº¦ç¶“æ¿Ÿæ´»å‹•çš„åˆæ­¥è©•ä¼°ã€‚" },
  "2025-08-01": { time: "21:30", title: "ğŸ‡ºğŸ‡¸ ç¾åœ‹éè¾²å°±æ¥­æ•¸æ“š (NFP)", desc: "å…«æœˆçš„éè¾²å ±å‘Šï¼Œå°‡ç‚ºå¤æœ«çš„å¸‚å ´æƒ…ç·’å®šèª¿ã€‚" },
  "2025-08-15": { time: "12:00", title: "ğŸ‡®ğŸ‡³ å°åº¦ç¨ç«‹ç´€å¿µæ—¥", desc: "å°åº¦ç¸½ç†å°‡ç™¼è¡¨æ¼”èªªï¼Œé—¡è¿°æœªä¾†æ”¿åºœçš„æ–½æ”¿é‡é»ï¼Œå°¤å…¶æ˜¯åœ¨ç¶“æ¿Ÿç™¼å±•å’Œå¤–äº¤æ”¿ç­–æ–¹é¢ã€‚" }
};

// ===== éŠæˆ²è¨­å®š =====
const CONFIG = {
  gameDurationMonths: 1,
  ï¿½
